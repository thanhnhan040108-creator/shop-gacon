<!doctype html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Shop - Đăng nhập</title>
  <link rel="stylesheet" href="/app.css" />
</head>
<body>
  <div class="container">
    <div class="nav">
      <div class="brand">
        <div class="logo"></div>
        <h1>SHOP-GACON</h1>
      </div>
      <div class="right">
        <a class="pill" href="/admin.html">Admin</a>
      </div>
    </div>

    <div class="grid">
      <div class="card">
        <h2>Đăng nhập</h2>
        <div class="row">
          <input id="loginUser" placeholder="Tên tài khoản" />
          <input id="loginPass" type="password" placeholder="Mật khẩu" />
          <button id="btnLogin">Đăng nhập</button>
        </div>
        <div id="loginMsg" class="note" style="display:none"></div>
      </div>

      <div class="card">
        <h2>Đăng ký</h2>
        <div class="row">
          <input id="regUser" placeholder="Tên tài khoản" />
          <input id="regPass" type="password" placeholder="Mật khẩu (>=6 ký tự)" />
          <input id="regGmail" placeholder="Gmail" />
          <button id="btnRegister" class="btn-secondary">Đăng ký</button>
        </div>
        <div id="regMsg" class="note" style="display:none"></div>
      </div>
    </div>
      <div class="card">
        <h2>Khôi phục tài khoản</h2>
        <div class="muted">Nhập đúng Gmail đã đăng ký để đặt lại mật khẩu.</div>
        <div class="row">
          <input id="fpUser" placeholder="Tên tài khoản" />
          <input id="fpGmail" placeholder="Gmail đã đăng ký" />
          <input id="fpNewPass" type="password" placeholder="Mật khẩu mới (>=6 ký tự)" />
          <button id="btnReset" class="btn-secondary">Đổi mật khẩu</button>
        </div>
        <div id="fpMsg" class="note" style="display:none"></div>
      </div>

  </div>

<script>
function show(id, text){
  const el = document.getElementById(id);
  el.style.display = "block";
  el.innerText = text;
}

btnLogin.onclick = async () => {
  const username = loginUser.value.trim();
  const password = loginPass.value.trim();

  const r = await fetch("/api/auth/login", {
    method:"POST",
    headers:{"Content-Type":"application/json"},
    body: JSON.stringify({ username, password })
  });
  const d = await r.json();
  if(!d.ok) return show("loginMsg", d.msg || "Đăng nhập thất bại");

  localStorage.setItem("username", d.user.username);
  localStorage.setItem("gmail", d.user.gmail);
  location.href = "/home.html";
};

btnRegister.onclick = async () => {
  const username = regUser.value.trim();
  const password = regPass.value.trim();
  const gmail = regGmail.value.trim();

  const r = await fetch("/api/auth/register", {
    method:"POST",
    headers:{"Content-Type":"application/json"},
    body: JSON.stringify({ username, password, gmail })
  });
  const d = await r.json();
  if(!d.ok) return show("regMsg", d.msg || "Đăng ký thất bại");

  show("regMsg", "Đăng ký thành công. Bạn có thể đăng nhập.");
};

btnReset.onclick = async () => {
  const username = fpUser.value.trim();
  const gmail = fpGmail.value.trim();
  const newPassword = fpNewPass.value.trim();

  const r = await fetch("/api/auth/reset-password", {
    method:"POST",
    headers:{"Content-Type":"application/json"},
    body: JSON.stringify({ username, gmail, newPassword })
  });
  const d = await r.json();
  if(!d.ok) return show("fpMsg", d.msg || "Khôi phục thất bại");

  show("fpMsg", "Đổi mật khẩu thành công. Bạn có thể đăng nhập.");
};

</script>
</body>
</html>
