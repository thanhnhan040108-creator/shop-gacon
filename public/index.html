<!doctype html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Shop Gacon - Đăng nhập</title>
  <link rel="stylesheet" href="/app.css" />
</head>
<body>
  <div class="container">
    <div class="nav">
      <div class="brand">
        <div class="logo"></div>
        <h1>SHOP-GACON</h1>
      </div>
      <div class="right">
        <a class="pill" href="/admin.html">Admin</a>
      </div>
    </div>

    <div class="grid">
      <div class="card">
        <h2>Đăng nhập</h2>
        <div class="muted">Đăng nhập xong sẽ chuyển vào Home và hiện dịch vụ.</div>

        <div class="row">
          <input id="loginUser" placeholder="Tên tài khoản" />
          <input id="loginPass" type="password" placeholder="Mật khẩu" />
          <button id="btnLogin">Đăng nhập</button>
        </div>

        <div id="loginMsg" class="note" style="display:none"></div>
      </div>

      <div class="card">
        <h2>Đăng ký</h2>
        <div class="muted">Tạo tài khoản: username + password + gmail.</div>

        <div class="row">
          <input id="regUser" placeholder="Tên tài khoản" />
          <input id="regPass" type="password" placeholder="Mật khẩu" />
          <input id="regGmail" placeholder="Gmail" />
          <button id="btnRegister" class="btn-secondary">Đăng ký</button>
        </div>

        <div id="regMsg" class="note" style="display:none"></div>
      </div>
    </div>
  </div>

<script>
function show(id, html){
  const el = document.getElementById(id);
  el.style.display = "block";
  el.innerHTML = html;
}

document.getElementById("btnLogin").onclick = async () => {
  const username = document.getElementById("loginUser").value.trim();
  const password = document.getElementById("loginPass").value.trim();
  const r = await fetch("/api/auth/login", {
    method:"POST",
    headers:{"Content-Type":"application/json"},
    body: JSON.stringify({ username, password })
  });
  const data = await r.json();
  if(!data.ok) return show("loginMsg", "❌ " + (data.msg || "Đăng nhập thất bại"));
  localStorage.setItem("username", data.user.username);
  localStorage.setItem("gmail", data.user.gmail);
  window.location.href = "/home.html";
};

document.getElementById("btnRegister").onclick = async () => {
  const username = document.getElementById("regUser").value.trim();
  const password = document.getElementById("regPass").value.trim();
  const gmail = document.getElementById("regGmail").value.trim();

  const r = await fetch("/api/auth/register", {
    method:"POST",
    headers:{"Content-Type":"application/json"},
    body: JSON.stringify({ username, password, gmail })
  });
  const data = await r.json();
  if(!data.ok) return show("regMsg", "❌ " + (data.msg || "Đăng ký thất bại"));
  show("regMsg", "✅ Đăng ký thành công. Bạn có thể đăng nhập.");
};
</script>
</body>
</html>
