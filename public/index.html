<!doctype html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Shop GÃ  Con - ÄÄƒng nháº­p</title>
  <link rel="stylesheet" href="app.css" />
  <style>
    .auth-wrap{max-width:980px;margin:0 auto;padding:18px}
    .auth-grid{display:grid;grid-template-columns:1fr 1fr;gap:14px;margin-top:14px}
    @media (max-width:860px){.auth-grid{grid-template-columns:1fr}}
    .small{font-size:12px}
    .row2{display:grid;grid-template-columns:1fr 1fr;gap:10px}
    @media (max-width:520px){.row2{grid-template-columns:1fr}}
    .pass-wrap{display:flex;gap:8px;align-items:center}
    .icon-btn{min-width:44px;height:42px;border-radius:12px;border:1px solid rgba(255,255,255,.12);background:rgba(255,255,255,.06);color:#e8eeff;cursor:pointer}
  </style>
</head>

<body class="page">
  <div class="auth-wrap">
    <div class="topbar">
      <div>
        <b>Shop GÃ  Con</b>
        <div class="muted small">ÄÄƒng nháº­p user Ä‘á»ƒ vÃ o trang Home</div>
      </div>
      <div style="display:flex;gap:10px;flex-wrap:wrap">
        <a class="btn" href="admin.html">Admin</a>
        <a class="btn" target="_blank" rel="noopener" href="https://www.facebook.com/share/1ajgzqUGdh/">LiÃªn há»‡</a>
      </div>
    </div>

    <div class="auth-grid">
      <!-- LOGIN -->
      <div class="card">
        <h2>ÄÄƒng nháº­p</h2>

        <div class="field">
          <label>TÃªn tÃ i khoáº£n</label>
          <input id="l_user" placeholder="vd: user123" autocomplete="username" />
        </div>

        <div class="field">
          <label>Máº­t kháº©u</label>
          <div class="pass-wrap">
            <input id="l_pass" type="password" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢" autocomplete="current-password" style="flex:1" />
            <button class="icon-btn" id="toggleLoginPass" title="Hiá»‡n/áº©n máº­t kháº©u">ğŸ‘</button>
          </div>
        </div>

        <button class="btn primary" id="btnLogin">ÄÄƒng nháº­p</button>
        <div id="loginMsg" class="muted" style="margin-top:10px"></div>

        <div class="hr"></div>
        <div class="muted small">
          Náº¿u Ä‘Äƒng nháº­p xong khÃ´ng vÃ o Home: hÃ£y cháº¯c cháº¯n file <b>home.html</b> náº±m trong thÆ° má»¥c <b>public</b>.
        </div>
      </div>

      <!-- REGISTER + RESET -->
      <div class="card">
        <h2>ÄÄƒng kÃ½</h2>

        <div class="row2">
          <div class="field">
            <label>TÃªn tÃ i khoáº£n</label>
            <input id="r_user" placeholder="vd: thanhnhan" autocomplete="username" />
          </div>
          <div class="field">
            <label>Gmail (khÃ´i phá»¥c)</label>
            <input id="r_gmail" placeholder="vd: abc@gmail.com" autocomplete="email" />
          </div>
        </div>

        <div class="field">
          <label>Máº­t kháº©u</label>
          <div class="pass-wrap">
            <input id="r_pass" type="password" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢" autocomplete="new-password" style="flex:1" />
            <button class="icon-btn" id="toggleRegPass" title="Hiá»‡n/áº©n máº­t kháº©u">ğŸ‘</button>
          </div>
        </div>

        <button class="btn" id="btnRegister">Táº¡o tÃ i khoáº£n</button>
        <div id="regMsg" class="muted" style="margin-top:10px"></div>

        <div class="hr"></div>

        <h2>KhÃ´i phá»¥c tÃ i khoáº£n</h2>
        <div class="muted small">Nháº­p Ä‘Ãºng <b>Gmail Ä‘Ã£ Ä‘Äƒng kÃ½</b> Ä‘á»ƒ Ä‘á»•i máº­t kháº©u.</div>

        <div class="row2" style="margin-top:10px">
          <div class="field">
            <label>TÃªn tÃ i khoáº£n</label>
            <input id="fp_user" placeholder="user123" />
          </div>
          <div class="field">
            <label>Gmail</label>
            <input id="fp_gmail" placeholder="abc@gmail.com" />
          </div>
        </div>

        <div class="field">
          <label>Máº­t kháº©u má»›i</label>
          <div class="pass-wrap">
            <input id="fp_newpass" type="password" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢" style="flex:1" />
            <button class="icon-btn" id="toggleFpPass" title="Hiá»‡n/áº©n máº­t kháº©u">ğŸ‘</button>
          </div>
        </div>

        <button class="btn primary" id="btnReset">Äá»•i máº­t kháº©u</button>
        <div id="fpMsg" class="muted" style="margin-top:10px"></div>
      </div>
    </div>
  </div>

  <script>
    async function api(path, method="GET", body=null){
      const res = await fetch(path, {
        method,
        headers: body ? {"Content-Type":"application/json"} : {},
        body: body ? JSON.stringify(body) : null
      });
      return res.json();
    }

    // Náº¿u Ä‘Ã£ cÃ³ username thÃ¬ vÃ o tháº³ng home
    const savedUser = localStorage.getItem("username");
    if (savedUser) window.location.assign("home.html");

    function togglePass(inputId){
      const el = document.getElementById(inputId);
      el.type = (el.type === "password") ? "text" : "password";
    }
    document.getElementById("toggleLoginPass").onclick = () => togglePass("l_pass");
    document.getElementById("toggleRegPass").onclick   = () => togglePass("r_pass");
    document.getElementById("toggleFpPass").onclick    = () => togglePass("fp_newpass");

    // REGISTER
    document.getElementById("btnRegister").onclick = async () => {
      const username = document.getElementById("r_user").value.trim();
      const gmail = document.getElementById("r_gmail").value.trim();
      const password = document.getElementById("r_pass").value.trim();
      const msg = document.getElementById("regMsg");
      msg.textContent = "Äang táº¡o...";

      const data = await api("/api/auth/register", "POST", { username, gmail, password });
      if (!data.ok) { msg.textContent = "Lá»—i: " + (data.msg || data.error || "KhÃ´ng rÃµ"); return; }

      msg.textContent = "Táº¡o tÃ i khoáº£n thÃ nh cÃ´ng. Báº¡n cÃ³ thá»ƒ Ä‘Äƒng nháº­p.";
    };

    // LOGIN
    document.getElementById("btnLogin").onclick = async () => {
      const username = document.getElementById("l_user").value.trim();
      const password = document.getElementById("l_pass").value.trim();
      const msg = document.getElementById("loginMsg");
      msg.textContent = "Äang Ä‘Äƒng nháº­p...";

      const data = await api("/api/auth/login", "POST", { username, password });
      if (!data.ok) { msg.textContent = "Sai tÃ i khoáº£n hoáº·c máº­t kháº©u."; return; }

      // LÆ°u username Ä‘á»ƒ home dÃ¹ng
      localStorage.setItem("username", data.user.username);

      // Chuyá»ƒn trang báº±ng Ä‘Æ°á»ng dáº«n tÆ°Æ¡ng Ä‘á»‘i (KHÃ”NG dÃ¹ng /home.html)
      window.location.assign("home.html");
    };

    // RESET PASSWORD
    document.getElementById("btnReset").onclick = async () => {
      const username = document.getElementById("fp_user").value.trim();
      const gmail = document.getElementById("fp_gmail").value.trim();
      const newPassword = document.getElementById("fp_newpass").value.trim();
      const msg = document.getElementById("fpMsg");
      msg.textContent = "Äang xá»­ lÃ½...";

      const data = await api("/api/auth/reset-password", "POST", { username, gmail, newPassword });
      if (!data.ok) { msg.textContent = "Lá»—i: " + (data.msg || data.error || "KhÃ´ng rÃµ"); return; }

      msg.textContent = "Äá»•i máº­t kháº©u thÃ nh cÃ´ng. Giá» báº¡n Ä‘Äƒng nháº­p láº¡i.";
    };
  </script>
</body>
        </html>
