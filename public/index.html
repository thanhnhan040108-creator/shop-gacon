<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Shop Gà Con - Đăng nhập</title>
  <link rel="stylesheet" href="app.css" />
</head>
<body class="center">

  <div class="card card-lg">
    <div class="brand">
      <div class="logo">GC</div>
      <div>
        <h2>Shop Gà Con</h2>
        <div class="muted">Đăng nhập để đặt dịch vụ / nạp tiền</div>
      </div>
    </div>

    <div class="tabs">
      <button class="tab active" data-tab="login">Đăng nhập</button>
      <button class="tab" data-tab="register">Đăng ký</button>
      <button class="tab" data-tab="forgot">Quên MK</button>
    </div>

    <div class="panel show" id="tab-login">
      <label>Tên tài khoản</label>
      <input id="l_user" placeholder="vd: gacon" autocomplete="username" />

      <label>Mật khẩu</label>
      <input id="l_pass" type="password" placeholder="••••••••" autocomplete="current-password" />

      <button class="btn" onclick="login()">Đăng nhập</button>
      <div id="msg" class="msg"></div>

      <div class="hint">
        Admin? <a href="admin.html">Đăng nhập admin</a>
      </div>
    </div>

    <div class="panel" id="tab-register">
      <label>Tên tài khoản</label>
      <input id="r_user" placeholder="Tên tài khoản" autocomplete="username" />

      <label>Email (dùng để khôi phục)</label>
      <input id="r_email" placeholder="email@example.com" autocomplete="email" />

      <label>Mật khẩu</label>
      <input id="r_pass" type="password" placeholder="Tạo mật khẩu" autocomplete="new-password" />

      <button class="btn" onclick="register()">Đăng ký</button>
      <div id="msg2" class="msg"></div>
    </div>

    <div class="panel" id="tab-forgot">
      <div class="muted" style="margin-bottom:10px">
        Xác minh bằng <b>tên tài khoản + email</b> rồi đặt mật khẩu mới.
      </div>

      <label>Tên tài khoản</label>
      <input id="f_user" placeholder="Tên tài khoản" />

      <label>Email</label>
      <input id="f_email" placeholder="Email đã đăng ký" />

      <label>Mật khẩu mới</label>
      <input id="f_pass" type="password" placeholder="Mật khẩu mới" />

      <button class="btn" onclick="forgot()">Đổi mật khẩu</button>
      <div id="msg3" class="msg"></div>
    </div>
  </div>

<script>
  document.querySelectorAll(".tab").forEach(btn=>{
    btn.addEventListener("click", ()=>{
      document.querySelectorAll(".tab").forEach(x=>x.classList.remove("active"));
      btn.classList.add("active");
      const tab = btn.dataset.tab;
      document.querySelectorAll(".panel").forEach(p=>p.classList.remove("show"));
      document.getElementById("tab-"+tab).classList.add("show");
    });
  });

  async function login() {
    msg.textContent = "";
    try {
      const r = await fetch("/api/login", {
        method:"POST",
        headers:{ "Content-Type":"application/json" },
        body: JSON.stringify({ username: l_user.value, password: l_pass.value })
      });
      const d = await r.json();
      if(!r.ok) throw new Error(d.msg || "Sai tài khoản hoặc mật khẩu");
      localStorage.setItem("user", JSON.stringify(d.user));
      location.href = "home.html";
    } catch(e) {
      msg.textContent = e.message || "Sai tài khoản hoặc mật khẩu";
    }
  }

  async function register() {
    msg2.textContent = "";
    try {
      const r = await fetch("/api/register", {
        method:"POST",
        headers:{ "Content-Type":"application/json" },
        body: JSON.stringify({ username: r_user.value, email: r_email.value, password: r_pass.value })
      });
      const d = await r.json();
      if(!r.ok) throw new Error(d.msg || "Đăng ký thất bại");
      msg2.textContent = d.msg;
    } catch(e) {
      msg2.textContent = e.message;
    }
  }

  async function forgot() {
    msg3.textContent = "";
    try {
      const r = await fetch("/api/forgot", {
        method:"POST",
        headers:{ "Content-Type":"application/json" },
        body: JSON.stringify({ username: f_user.value, email: f_email.value, newPassword: f_pass.value })
      });
      const d = await r.json();
      if(!r.ok) throw new Error(d.msg || "Thất bại");
      msg3.textContent = d.msg;
    } catch(e) {
      msg3.textContent = e.message;
    }
  }
</script>
</body>
</html>
