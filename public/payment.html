<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Thanh toán - Shop Gà Con</title>
  <link rel="stylesheet" href="app.css" />
</head>
<body class="center">
  <div class="card card-lg">
    <div class="brand">
      <div class="logo" id="logoTxt">MB</div>
      <div>
        <h2 id="pageTitle">Cổng thanh toán</h2>
        <div class="muted">Quét QR và chuyển đúng nội dung</div>
      </div>
    </div>

    <div class="pay-grid">
      <div class="pay-qr">
        <img src="mb-qr.jpg" alt="MB QR" />
      </div>

      <div class="pay-info">
        <div class="pill" id="typePill">Đơn</div>

        <div class="pay-line"><span>Tài khoản:</span> <b id="pUser"></b></div>
        <div class="pay-line" id="rowService" style="display:none"><span>Dịch vụ:</span> <b id="pService"></b></div>
        <div class="pay-line" id="rowNote" style="display:none"><span>Ghi chú:</span> <b id="pNote"></b></div>
        <div class="pay-line"><span>Số tiền:</span> <b id="pAmount"></b></div>
        <div class="pay-line"><span>Phương thức:</span> <b id="pMethod">MB Bank</b></div>

        <div class="pay-box">
          <div class="muted">Nội dung chuyển khoản</div>
          <div class="code" id="pCode"></div>
          <div class="muted small">Chuyển đúng nội dung để admin duyệt nhanh.</div>
        </div>

        <div style="margin-top:12px; display:flex; gap:10px">
          <button class="btn ghost" onclick="back()">Quay lại</button>
          <button class="btn" onclick="copyCode()">Copy nội dung</button>
        </div>

        <div id="msg" class="msg"></div>
      </div>
    </div>
  </div>

<script>
  function formatVND(n){
    n = Number(n||0);
    return n.toLocaleString("vi-VN") + "đ";
  }
  function getType(){
    const qs = new URLSearchParams(location.search);
    return (qs.get("type") || "").toLowerCase();
  }

  const type = getType(); // order | topup
  const order = JSON.parse(localStorage.getItem("pay_order") || "null");
  const topup = JSON.parse(localStorage.getItem("pay_topup") || "null");

  if(type === "order"){
    if(!order) location.href = "home.html";
    logoTxt.textContent = "GC";
    pageTitle.textContent = "Thanh toán đơn dịch vụ";
    typePill.textContent = "Đơn hàng";

    pUser.textContent = order.username || "";
    rowService.style.display = "";
    rowNote.style.display = "";

    pService.textContent = order.service || "";
    pNote.textContent = order.note || "(trống)";
    pAmount.textContent = formatVND(order.price || 0);
    pCode.textContent = order.payCode || "";
  } else {
    if(!topup) location.href = "home.html";
    logoTxt.textContent = "MB";
    pageTitle.textContent = "Thanh toán nạp tiền";
    typePill.textContent = "Nạp tiền";

    pUser.textContent = topup.username || "";
    pAmount.textContent = formatVND(topup.amount || 0);
    pMethod.textContent = topup.method || "MB Bank";
    pCode.textContent = topup.code || "";
  }

  function back(){ location.href = "home.html"; }

  async function copyCode(){
    try{
      await navigator.clipboard.writeText(pCode.textContent);
      msg.textContent = "Đã copy nội dung chuyển khoản.";
    }catch(e){
      msg.textContent = "Không copy được. Bạn tự copy: " + pCode.textContent;
    }
  }
</script>
</body>
</html>
