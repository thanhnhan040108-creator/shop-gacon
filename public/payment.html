<!doctype html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Payment</title>
  <link rel="stylesheet" href="/public/app.css" />
</head>
<body>
  <div class="topbar">
    <div class="brand">Cổng thanh toán</div>
    <a class="btn" href="/home">Về Home</a>
  </div>

  <div class="container">
    <div class="card">
      <h2>Thông tin nạp</h2>
      <div id="info" class="muted">Đang tải...</div>
    </div>

    <div class="card">
      <h2>Hướng dẫn chuyển khoản (MB Bank)</h2>
      <div class="muted">
        Bạn chuyển khoản theo thông tin dưới đây. Admin sẽ duyệt và cộng số dư sau.
      </div>
      <hr>
      <div class="row">
        <div class="card" style="flex:1">
          <b>Ngân hàng:</b> MB Bank<br>
          <b>Chủ TK:</b> (Bạn tự điền)<br>
          <b>Số TK:</b> (Bạn tự điền)<br>
          <b>Nội dung:</b> <span id="codeBox" class="badge">...</span>
        </div>
      </div>
      <div class="muted" style="margin-top:10px">
        (Tuỳ chọn) Nếu bạn có ảnh QR, đặt tên <b>mb-qr.jpg</b> trong /public rồi hiển thị ở dưới:
      </div>
      <img src="/public/mb-qr.jpg" alt="QR" style="max-width:280px;margin-top:10px;border-radius:12px;border:1px solid rgba(255,255,255,.12)" onerror="this.style.display='none'">
    </div>
  </div>

<script>
function money(n){ return (Number(n)||0).toLocaleString("vi-VN"); }
async function get(url){
  const r = await fetch(url);
  const j = await r.json().catch(()=>({ok:false}));
  if(!r.ok) throw new Error(j.message || "Request lỗi");
  return j;
}
const params = new URLSearchParams(location.search);
const id = params.get("id");

(async ()=>{
  try{
    if(!id){ location.href="/home"; return; }
    const r = await get("/api/topup/" + encodeURIComponent(id));
    const t = r.topup;
    document.getElementById("codeBox").textContent = t.code;
    document.getElementById("info").innerHTML = `
      <div>Mã nạp: <b>${t.code}</b></div>
      <div>Số tiền: <b>${money(t.amount)}đ</b></div>
      <div>Trạng thái: <b>${t.status}</b></div>
    `;
  }catch(e){
    location.href="/home";
  }
})();
</script>
</body>
</html>
