<!doctype html>
<html lang="vi">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Shop GÃ  Con â€¢ Dá»‹ch vá»¥ Blox Fruit</title>
  <link rel="stylesheet" href="/app.css"/>
</head>

<body class="app">
<header class="topbar">
  <div class="brand">
    <div class="logo">SG</div>
    <div>
      <div class="title">Shop GÃ  Con</div>
      <div class="sub">Dá»‹ch vá»¥ Blox Fruit</div>
    </div>
  </div>

  <div class="actions">
    <span id="meName" class="badge">...</span>
    <button class="btn btn-danger" id="btnLogout">ÄÄƒng xuáº¥t</button>
  </div>
</header>

<main class="container">

<!-- ================= Dá»ŠCH Vá»¤ ================= -->
<section class="card">
  <h2>Dá»‹ch vá»¥</h2>
  <p class="muted">Chá»n dá»‹ch vá»¥ â†’ ghi chÃº (acc/yÃªu cáº§u) â†’ táº¡o Ä‘Æ¡n. Tráº¡ng thÃ¡i hiá»ƒn thá»‹ á»Ÿ Lá»‹ch sá»­.</p>

  <!-- CÃ€Y LEVEL -->
  <h3>CÃ y Level / Beli / Frag / Mastery</h3>

  <div class="service">
    <span>Lv 1 â€“ 700</span><b>10.000Ä‘</b>
    <input placeholder="VD: acc/mk, yÃªu cáº§u, thá»i gian ráº£nh..." id="note_lv1"/>
    <button onclick="createOrder('Lv 1-700',10000,'note_lv1')">Táº¡o Ä‘Æ¡n</button>
  </div>

  <div class="service">
    <span>Lv 700 â€“ 1500</span><b>10.000Ä‘</b>
    <input id="note_lv2"/>
    <button onclick="createOrder('Lv 700-1500',10000,'note_lv2')">Táº¡o Ä‘Æ¡n</button>
  </div>

  <div class="service">
    <span>Lv 1500 â€“ Max</span><b>20.000Ä‘</b>
    <input id="note_lv3"/>
    <button onclick="createOrder('Lv 1500-Max',20000,'note_lv3')">Táº¡o Ä‘Æ¡n</button>
  </div>

  <div class="service">
    <span>Lv 1 â€“ Max (Godhuman)</span><b>50.000Ä‘</b>
    <input id="note_lv4"/>
    <button onclick="createOrder('Lv 1-Max + Godhuman',50000,'note_lv4')">Táº¡o Ä‘Æ¡n</button>
  </div>

  <div class="service">
    <span>9M Beli</span><b>10.000Ä‘</b>
    <input id="note_beli"/>
    <button onclick="createOrder('9M Beli',10000,'note_beli')">Táº¡o Ä‘Æ¡n</button>
  </div>

  <div class="service">
    <span>20K Fragment</span><b>10.000Ä‘</b>
    <input id="note_frag"/>
    <button onclick="createOrder('20K Fragment',10000,'note_frag')">Táº¡o Ä‘Æ¡n</button>
  </div>

  <!-- BOUNTY -->
  <h3>Bounty Hunt</h3>

  <div class="service">
    <span>1M Bounty Háº£i Táº·c</span><b>10.000Ä‘</b>
    <input id="note_bt1"/>
    <button onclick="createOrder('1M Bounty Háº£i Táº·c',10000,'note_bt1')">Táº¡o Ä‘Æ¡n</button>
  </div>

  <div class="service">
    <span>1M Bounty Háº£i QuÃ¢n</span><b>15.000Ä‘</b>
    <input id="note_bt2"/>
    <button onclick="createOrder('1M Bounty Háº£i QuÃ¢n',15000,'note_bt2')">Táº¡o Ä‘Æ¡n</button>
  </div>
</section>

<!-- ================= Náº P TIá»€N ================= -->
<section class="card">
  <h2>Náº¡p tiá»n</h2>
  <p class="muted">Táº¡o mÃ£ â†’ chuyá»ƒn khoáº£n Ä‘Ãºng ná»™i dung â†’ admin duyá»‡t.</p>

  <label>PhÆ°Æ¡ng thá»©c</label>
  <select id="payMethod">
    <option>MB Bank</option>
    <option>ZaloPay</option>
  </select>

  <label>Sá»‘ tiá»n (VND)</label>
  <input id="payAmount" type="number" placeholder="VD: 50000"/>

  <button class="btn" onclick="createTopup()">Táº¡o mÃ£ náº¡p</button>

  <div id="topupResult" class="muted"></div>
</section>

<!-- ================= Lá»ŠCH Sá»¬ ================= -->
<section class="card" id="history">
  <h2>Lá»‹ch sá»­</h2>
  <button class="btn btn-secondary" onclick="loadHistory()">Táº£i láº¡i</button>
  <div id="historyList" class="muted">Äang táº£i...</div>
</section>

</main>

<!-- NÃšT CHAT -->
<a href="https://www.facebook.com/share/1ajgzqUGdh/"
   target="_blank"
   class="chat-btn">ğŸ’¬</a>

<script>
/* ========= AUTH ========= */
async function api(path, opts={}){
  const r = await fetch(path,{credentials:'include',...opts});
  if(!r.ok) throw new Error(await r.text());
  return r.json();
}

async function init(){
  try{
    const me = await api('/api/me');
    document.getElementById('meName').innerText = me.username;
    loadHistory();
  }catch{
    location.href='/index.html';
  }
}
init();

document.getElementById('btnLogout').onclick = async ()=>{
  await fetch('/api/logout',{method:'POST'});
  location.href='/index.html';
};

/* ========= Táº O ÄÆ N ========= */
async function createOrder(service,amount,noteId){
  const note = document.getElementById(noteId).value;
  const data = await api('/api/orders',{
    method:'POST',
    headers:{'Content-Type':'application/json'},
    body:JSON.stringify({service,amount,note})
  });
  localStorage.setItem('pendingPayment',JSON.stringify({type:'order',id:data.id}));
  location.href=`/payment.html?type=order&id=${data.id}`;
}

/* ========= Náº P ========= */
async function createTopup(){
  const method=document.getElementById('payMethod').value;
  const amount=document.getElementById('payAmount').value;
  if(!amount) return alert('Nháº­p sá»‘ tiá»n');

  const data = await api('/api/topups',{
    method:'POST',
    headers:{'Content-Type':'application/json'},
    body:JSON.stringify({method,amount})
  });

  localStorage.setItem('pendingPayment',JSON.stringify({type:'topup',id:data.id}));
  location.href=`/payment.html?type=topup&id=${data.id}`;
}

/* ========= Lá»ŠCH Sá»¬ ========= */
async function loadHistory(){
  const h = await api('/api/history');
  let html='<h4>ÄÆ¡n dá»‹ch vá»¥</h4>';
  h.orders.forEach(o=>{
    html+=`<div>${o.service} | ${o.amount}Ä‘ | ${o.status}</div>`;
  });
  html+='<h4>Náº¡p tiá»n</h4>';
  h.topups.forEach(t=>{
    html+=`<div>${t.code} | ${t.amount}Ä‘ | ${t.status}</div>`;
  });
  document.getElementById('historyList').innerHTML=html;
}
</script>
</body>
      </html>
